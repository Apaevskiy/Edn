<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Поиск gln</title>
    <link rel="stylesheet" href="/static/css/gln.css" th:href="@{/css/gln.css}" type="text/css">
    <link rel="stylesheet" href="/static/css/gs1.css" th:href="@{/css/gs1.css}" type="text/css">
    <script src="/static/login/jquery.min.js" th:src="@{/login/jquery.min.js}"></script>
</head>
<body>
<div th:insert="sidebar.html :: sidebar"></div>
<section class="home-section ">
    <div class="ant-page-header ant-page-header-ghost">
        <div class="ant-page-header-heading">
            <div class="ant-page-header-heading-left">
                <span class="ant-page-header-heading-title" title="Панель управления">Панель управления</span>
            </div>
        </div>
    </div>
    <div class="workPlace">
        <form action="http://gepir.gs1by.by/Home/ResponsePartyByName" class="glnForm" data-ajax="true"
              data-ajax-mode="replace" data-ajax-update="#ResponsePartyByName" name="searchForm" id="form0"
              method="post">
            <div class="filterDiv">
                <label class="label-control" for="countryCode">Страна</label>
                <select class="form-control selectize" id="countryCode" name="countryCode">
                    <option value="BY" selected>Беларусь</option>
                    <option value="RU">Россия</option>
                </select>
            </div>
            <div class="filterDiv">
                <label class="control-label" for="companyName">Название</label>
                <input class="form-control" placeholder="Название" value="" id="companyName" name="companyName"
                       type="text"></div>
            <div class="filterDiv">
                <label class="control-label" for="streetAddress">Адрес (улица)</label>
                <input class="form-control" placeholder="Адрес (улица)" value="" id="streetAddress" name="streetAddress"
                       type="text">
            </div>
            <div class="filterDiv">
                <label class="control-label" for="zipCode">Почтовый индекс</label>
                <input class="form-control" placeholder="Почтовый индекс" value="" id="zipCode" name="zipCode"
                       type="text">
            </div>
            <div class="filterDiv">
                <label class="control-label" for="city">Город</label>
                <input class="form-control" placeholder="Город" value="" id="city" name="city" type="text">
            </div>
            <div class="row form-group">
                <div class="col-xs-6">
                    <div id="recaptcha2" style="padding-bottom:1em;"></div>
                    <input type="hidden" name="task" value="getPartyByName">
                    <input type="hidden" name="format" value="raw">
                </div>
            </div>
        </form>
        <button onclick="loadTableFromGS1()" class="button" data-toggle="collapse"
                data-target="#info" id="submit-button">Поиск
        </button>
        <div id="tableDiv">

        </div>
    </div>
</section>
<script>
    $('.details-toggle').click(function () {
        let table = $('#' + $(this).getAttribute('href'));
        table.toggleClass("collapsed");
        $(this).parent().find('tbody').toggle();
    });

    function loadTableFromGS1() {
        let xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://gepir.gs1by.by/Home/ResponsePartyByName');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        xhr.setRequestHeader('Origin', 'http://gepir.gs1by.by');
        // xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        // xhr.setRequestHeader('Accept-Encoding', 'gzip, deflate');
        xhr.setRequestHeader('Accept', '*/*');
        let formData = new FormData(document.forms.namedItem('searchForm'));
        formData.append('X-Requested-With', 'XMLHttpRequest');
        xhr.send(formData);

        xhr.onload = function () {
            if (xhr.status !== 200) {
                alert(`Ошибка ${xhr.status}: ${xhr.statusText}`);
            } else {
                $('#tableDiv').innerHTML = xhr.response.length;
            }
        };
    }
</script>
</body>
</html>